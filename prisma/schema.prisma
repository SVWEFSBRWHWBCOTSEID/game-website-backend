datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "cargo prisma"
    output   = "../src/prisma.rs"
}

model Game {
    id              String      @id
    createdAt       DateTime    @default(now())
    rated           Boolean
    gameKey         String
    clockInitial    Int?
    clockIncrement  Int?
    firstUsername   String?
    secondUsername  String?
    firstUser       User?       @relation("first", fields: [firstUsername], references: [username])
    secondUser      User?       @relation("second", fields: [secondUsername], references: [username])
    rating          Int
    ratingMin       Int
    ratingMax       Int
    startPos        String?
    moves           String
    chat            Message[]
    firstTime       Int?
    secondTime      Int?
    lastMoveTime    BigInt
    status          String
    winType         String?
    drawOffer       String
    rematchOffer    String
    randomSide      Boolean
}

model User {
    username        String      @unique
    createdAt       DateTime    @default(now())
    password        String
    guest           Boolean
    perfs           Perf[]
    country         String
    location        String
    bio             String
    firstName       String
    lastName        String
    url             String
    playing         String?
    firstUserGames  Game[]      @relation("first")
    secondUserGames Game[]      @relation("second")
    friends         Friend[]    @relation(name: "user")
    friendsRelation Friend[]    @relation(name: "friend")
}

model Friend {
    type        String
    user        User    @relation(name: "user", fields: [username], references: [username])
    friend      User    @relation(name: "friend", fields: [friendName], references: [username])
    username    String
    friendName  String
    @@unique([username, friendName])
}

model Perf {
    user        User    @relation(fields: [username], references: [username])
    username    String
    gameKey     String
    games       Int
    rating      Float
    rd          Float
    volatility  Float
    tau         Float
    prog        String
    prov        Boolean
    @@unique([username, gameKey])
}

model Message {
    id          String  @id @default(uuid())
    game        Game    @relation(fields: [gameId], references: [id])
    gameId      String
    username    String
    text        String
    visibility  String
    gameEvent   Boolean
}
